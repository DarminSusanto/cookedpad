name: ðŸš€ Clean Kubernetes Deploy

on:
  push:
    branches: [ main ]
    paths:
      - 'k8s/**'
      - '**.yml'
      - '**.yaml'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ› ï¸ Setup
        uses: actions/checkout@v4
        
      - name: ðŸ”§ Install kubectl
        uses: azure/setup-kubectl@v3
        
      - name: ðŸ” Setup Kubeconfig
        run: |
          echo "${{ secrets.KUBE_CONFIG }}" | base64 -d > $HOME/.kube/config
          kubectl version --client
          
      - name: ðŸš€ Deploy to K8s
        run: |
          echo "Deploying to Docker Desktop..."
          kubectl apply -f k8s/ --wait=true
          
      - name: âœ… Verify
        run: |
          echo "=== DEPLOYMENT STATUS ==="
          kubectl get pods -A
          echo "=== SERVICES ==="
          kubectl get svc -A